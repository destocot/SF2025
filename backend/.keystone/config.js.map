{
  "version": 3,
  "sources": ["../keystone.ts", "../seed-data/index.ts", "../seed-data/products.json"],
  "sourcesContent": ["import \"dotenv/config\";\nimport { config, list } from \"@keystone-6/core\";\nimport {\n  text,\n  password,\n  select,\n  integer,\n  relationship,\n  image,\n} from \"@keystone-6/core/fields\";\nimport { allowAll } from \"@keystone-6/core/access\";\nimport { createAuth } from \"@keystone-6/auth\";\nimport { statelessSessions } from \"@keystone-6/core/session\";\nimport { cloudinaryImage } from \"@keystone-6/cloudinary\";\nimport { v2 as cloudinary } from \"cloudinary\";\nimport { insertSeedData } from \"./seed-data\";\n\nfunction timestamp() {\n  // sometime in the last 30 days\n  const stampy =\n    Date.now() - Math.floor(Math.random() * 1000 * 60 * 60 * 24 * 30);\n  return new Date(stampy).toISOString();\n}\n\nconst session = statelessSessions({\n  maxAge: 60 * 60 * 24 * 30,\n  secret: process.env.COOKIE_SECRET,\n});\n\nconst { withAuth } = createAuth({\n  listKey: \"User\",\n  identityField: \"email\",\n  secretField: \"password\",\n  sessionData: `id name email`,\n  initFirstItem: {\n    fields: [\"name\", \"email\", \"password\"],\n  },\n});\n\nconst lists = {\n  User: list({\n    access: allowAll,\n    fields: {\n      name: text({ validation: { isRequired: true } }),\n      email: text({\n        validation: { isRequired: true },\n        isIndexed: \"unique\",\n      }),\n      password: password(),\n    },\n  }),\n  Product: list({\n    access: allowAll,\n    fields: {\n      name: text({ validation: { isRequired: true } }),\n      description: text({\n        ui: {\n          displayMode: \"textarea\",\n        },\n      }),\n      status: select({\n        options: [\n          { label: \"Draft\", value: \"DRAFT\" },\n          { label: \"Available\", value: \"AVAILABLE\" },\n          { label: \"Unavailable\", value: \"UNAVAILABLE\" },\n        ],\n        defaultValue: \"DRAFT\",\n        ui: {\n          displayMode: \"segmented-control\",\n          createView: { fieldMode: \"hidden\" },\n        },\n      }),\n      price: integer(),\n      photo: relationship({\n        ref: \"ProductImage.product\",\n        ui: {\n          displayMode: \"cards\",\n          cardFields: [\"image\", \"altText\"],\n          inlineCreate: { fields: [\"image\", \"altText\"] },\n          inlineEdit: { fields: [\"image\", \"altText\"] },\n          linkToItem: true,\n        },\n      }),\n    },\n  }),\n  ProductImage: list({\n    access: allowAll,\n    fields: {\n      image: cloudinaryImage({\n        label: \"Source\",\n        cloudinary: {\n          cloudName: `${process.env.CLOUDINARY_CLOUD_NAME}`,\n          apiKey: `${process.env.CLOUDINARY_API_KEY}`,\n          apiSecret: `${process.env.CLOUDINARY_API_SECRET}`,\n          folder: `${process.env.CLOUDINARY_API_FOLDER}`,\n        },\n      }),\n      altText: text(),\n      product: relationship({ ref: \"Product.photo\" }),\n    },\n  }),\n};\n\nexport default config(\n  withAuth({\n    db: {\n      provider: \"sqlite\",\n      url: `${process.env.DATABASE_URL}`,\n      onConnect: async (ctx) => {\n        if (process.argv.includes(\"--seed-data\")) {\n          await insertSeedData(ctx);\n        }\n      },\n    },\n    server: {\n      cors: { origin: [process.env.FRONTEND_URL], credentials: true },\n    },\n    lists,\n    session,\n    ui: {\n      isAccessAllowed: (ctx) => !!ctx.session?.data,\n    },\n  })\n);\n", "import \"dotenv/config\";\nimport { KeystoneContext } from \"@keystone-6/core/types\";\nimport products from \"./products.json\";\nimport { v2 as cloudinary } from \"cloudinary\";\n\ncloudinary.config({\n  api_key: process.env.CLOUDINARY_API_KEY,\n  api_secret: process.env.CLOUDINARY_API_SECRET,\n  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n});\n\nexport async function insertSeedData(ctx: KeystoneContext<any>) {\n  console.log(\"REMOVE THIS LINE TO SEED\");\n  return;\n\n  await ctx.db.ProductImage.deleteMany({\n    where: (\n      await ctx.db.ProductImage.findMany({})\n    ).map((img) => ({ id: img.id })),\n  });\n  await ctx.db.Product.deleteMany({\n    where: (await ctx.db.Product.findMany({})).map((p) => ({ id: p.id })),\n  });\n\n  console.log(`\uD83C\uDF31 Inserting Seed Data: ${products.length} Products`);\n\n  for (const product of products) {\n    console.log(`  \uD83D\uDECD\uFE0F Adding Product: ${product.name}`);\n\n    const res = await cloudinary.uploader.upload(product.photoUrl, {\n      folder: process.env.CLOUDINARY_API_FOLDER,\n    });\n\n    const cloudinaryImageData = {\n      id: res.public_id,\n      filename: product.filename,\n      originalFilename: product.filename,\n      mimetype: \"image/jpeg\",\n      encoding: \"7bit\",\n      _meta: {\n        public_id: res.public_id,\n        version: res.version,\n        signature: res.signature,\n        width: res.width,\n        height: res.height,\n        format: res.format,\n        resource_type: res.resource_type,\n        created_at: res.created_at,\n        tags: res.tags || [],\n        bytes: res.bytes,\n        type: res.type,\n        etag: res.etag,\n        placeholder: false,\n        url: res.url,\n        secure_url: res.secure_url,\n        original_filename: \"file\",\n      },\n    };\n\n    const productImage = await ctx.prisma.productImage.create({\n      data: {\n        image: JSON.stringify(cloudinaryImageData),\n        altText: product.description,\n      },\n    });\n\n    await ctx.prisma.product.create({\n      data: {\n        name: product.name,\n        description: product.description,\n        status: product.status,\n        price: product.price,\n        photo: { connect: { id: productImage.id } },\n      },\n    });\n  }\n\n  console.log(`\u2705 Seed Data Inserted: ${products.length} Products`);\n}\n", "[\n  {\n    \"name\": \"Yeti Hondo\",\n    \"description\": \"soo nice\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 3423,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1576791335/sick-fits-keystone/5dfbed262849d7961377c2c0.jpg\",\n    \"filename\": \"hondo.jpg\"\n  },\n  {\n    \"name\": \"Airmax 270\",\n    \"description\": \"Great shoes!\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 5234,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579815920/sick-fits-keystone/5e2a13f0689b2835ae71d1a5.jpg\",\n    \"filename\": \"270-camo-sunset.jpg\"\n  },\n  {\n    \"name\": \"KITH Hoodie\",\n    \"description\": \"Love this hoodie\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 23562,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579815935/sick-fits-keystone/5e2a13ff689b2835ae71d1a7.jpg\",\n    \"filename\": \"kith-hoodie.jpg\"\n  },\n  {\n    \"name\": \"Fanorak\",\n    \"description\": \"Super hip. Comes in a number of colours\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 252342,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579815957/sick-fits-keystone/5e2a1413689b2835ae71d1a9.png\",\n    \"filename\": \"TNF-fanorak.png\"\n  },\n  {\n    \"name\": \"Nike Vapormax\",\n    \"description\": \"Kind of squeaky on some floors\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 83456,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579815980/sick-fits-keystone/5e2a142c689b2835ae71d1ab.jpg\",\n    \"filename\": \"vapormax.jpg\"\n  },\n  {\n    \"name\": \"Yeti Cooler\",\n    \"description\": \"Who spends this much on a cooler?!\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 75654,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579815999/sick-fits-keystone/5e2a143f689b2835ae71d1ad.jpg\",\n    \"filename\": \"coral-yeti.jpg\"\n  },\n  {\n    \"name\": \"Naked and Famous Denim\",\n    \"description\": \"Japanese Denim, made in Canada\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 10924,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579816030/sick-fits-keystone/5e2a145d689b2835ae71d1af.jpg\",\n    \"filename\": \"naked-and-famous-denim.jpg\"\n  },\n  {\n    \"name\": \"Rimowa Luggage\",\n    \"description\": \"S T E A L T H\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 47734,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579816060/sick-fits-keystone/5e2a147b689b2835ae71d1b1.png\",\n    \"filename\": \"rimowa.png\"\n  },\n  {\n    \"name\": \"Black Hole \",\n    \"description\": \"Outdoorsy \",\n    \"status\": \"AVAILABLE\",\n    \"price\": 4534,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579816093/sick-fits-keystone/5e2a149b689b2835ae71d1b3.jpg\",\n    \"filename\": \"patagonia black hole.jpg\"\n  },\n  {\n    \"name\": \"Nudie Belt\",\n    \"description\": \"Sick design\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 5234,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579816114/sick-fits-keystone/5e2a14b1689b2835ae71d1b5.jpg\",\n    \"filename\": \"nudie-belt.jpg\"\n  },\n  {\n    \"name\": \"Goose\",\n    \"description\": \"Keep warm.\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 74544,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579816128/sick-fits-keystone/5e2a14bf689b2835ae71d1b7.jpg\",\n    \"filename\": \"canada-goose.jpg\"\n  },\n  {\n    \"name\": \"Ultraboost\",\n    \"description\": \"blacked out\",\n    \"status\": \"AVAILABLE\",\n    \"price\": 6344,\n    \"photoUrl\": \"https://res.cloudinary.com/wesbos/image/upload/v1579816141/sick-fits-keystone/5e2a14cc689b2835ae71d1b9.jpg\",\n    \"filename\": \"ultra-boost.jpg\"\n  }\n]\n"],
  "mappings": "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",
  "names": ["import_config", "import_cloudinary", "cloudinary"]
}
